<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title id="tituloPagina">Consulta de Datos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/estilos.css">
</head>

<body>
<header>
  <h1 id="titulo">Ãrea de Consulta y GestiÃ³n</h1>
  <nav>
    <ul>
      <li><a id="menuInicio" href="index.html">Inicio</a></li>
    </ul>
  </nav>

  <label for="selectorIdioma">ğŸŒ Idioma:</label>
  <select id="selectorIdioma">
    <option value="es">EspaÃ±ol</option>
    <option value="en">English</option>
  </select>
</header>

<main>
  <section>
    <h2 id="etiquetaEventos">ğŸ“… Eventos</h2>
    <ul id="listaEventos"></ul>
  </section>

  <section>
    <h2 id="etiquetaUbicaciones">ğŸ“ Ubicaciones</h2>
    <ul id="listaUbicaciones"></ul>
  </section>

  <section>
    <h2 id="etiquetaContactos">ğŸ‘¤ Contactos</h2>
    <ul id="listaContactos"></ul>
  </section>

  <a href="index.html" id="btnRegresar" class="btn-regresar">â† Regresar</a>
</main>

<footer>
  <p>&copy; 2025 INTERACCIÃ“N HOMBRE MAQUINA</p>
  <p>&copy; AUTOR STEVEN TIPANTUÃ‘A</p>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import {
  getFirestore,
  collection,
  getDocs,
  deleteDoc,
  updateDoc,
  doc
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAjsWFlifV6vrqfgPaiVvwnV6YeICRBWu4",
  authDomain: "gestion-eventos-caso2.firebaseapp.com",
  projectId: "gestion-eventos-caso2",
  storageBucket: "gestion-eventos-caso2.appspot.com",
  messagingSenderId: "133499209288",
  appId: "1:133499209288:web:d1fdf1b96f2b9c3d07ba7d"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ================= EVENTOS ================= */
const eventosSnap = await getDocs(collection(db, "eventos_caso2"));
eventosSnap.forEach(d => {
  const e = d.data();
  document.getElementById("listaEventos").innerHTML += `
    <li>
      <strong>${e.titulo || "Sin tÃ­tulo"}</strong><br>
      ğŸ“… ${e.fecha || "-"} â° ${e.hora || "-"}<br>
      ğŸ“ ${e.lugar || "-"}<br>
      <button onclick="editarEvento('${d.id}', '${e.titulo || ""}')">âœï¸ Editar</button>
      <button onclick="eliminarEvento('${d.id}')">ğŸ—‘ï¸ Eliminar</button>
    </li><hr>
  `;
});

window.eliminarEvento = async function(id) {
  if (confirm("Â¿Eliminar este evento?")) {
    await deleteDoc(doc(db, "eventos_caso2", id));
    alert("âœ… Evento eliminado");
    location.reload();
  }
};

window.editarEvento = async function(id, tituloActual) {
  const nuevoTitulo = prompt("Editar tÃ­tulo:", tituloActual);
  if (nuevoTitulo) {
    await updateDoc(doc(db, "eventos_caso2", id), { titulo: nuevoTitulo });
    alert("âœï¸ Evento actualizado");
    location.reload();
  }
};

/* ================= UBICACIONES ================= */
const ubicSnap = await getDocs(collection(db, "ubicaciones_caso2"));
ubicSnap.forEach(d => {
  const u = d.data();
  document.getElementById("listaUbicaciones").innerHTML += `
    <li>
      <strong>${u.titulo || "Sin tÃ­tulo"}</strong><br>
      ğŸ“ ${u.direccion || "-"}<br>
      ğŸŒ ${u.latitud || "-"}, ${u.longitud || "-"}<br>
      <button onclick="eliminarUbicacion('${d.id}')">ğŸ—‘ï¸ Eliminar</button>
    </li><hr>
  `;
});

window.eliminarUbicacion = async function(id) {
  if (confirm("Â¿Eliminar esta ubicaciÃ³n?")) {
    await deleteDoc(doc(db, "ubicaciones_caso2", id));
    alert("âœ… UbicaciÃ³n eliminada");
    location.reload();
  }
};

/* ================= CONTACTOS ================= */
const contSnap = await getDocs(collection(db, "contactos_caso2"));
contSnap.forEach(d => {
  const c = d.data();
  document.getElementById("listaContactos").innerHTML += `
    <li>
      <strong>${c.nombre || "Sin nombre"}</strong><br>
      ğŸ“ ${c.telefono || "-"}<br>
      ğŸ“§ ${c.email || "-"}<br>
      <button onclick="eliminarContacto('${d.id}')">ğŸ—‘ï¸ Eliminar</button>
    </li><hr>
  `;
});

window.eliminarContacto = async function(id) {
  if (confirm("Â¿Eliminar este contacto?")) {
    await deleteDoc(doc(db, "contactos_caso2", id));
    alert("âœ… Contacto eliminado");
    location.reload();
  }
};
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const selector = document.getElementById("selectorIdioma");

  async function cargarIdioma(lang) {
    try {
      localStorage.setItem("idiomaPreferido", lang); // Guarda tu elecciÃ³n
      const res = await fetch(`json/${lang}.json`);
      const t = await res.json();

      for (const clave in t) {
        const elemento = document.getElementById(clave);
        if (elemento) {
          elemento.innerText = t[clave];
        }
      }
    } catch (error) {
      console.error("Error al cargar idioma:", error);
    }
  }

  selector.addEventListener("change", e => cargarIdioma(e.target.value));

  // Cargar el idioma que ya viene de las otras pÃ¡ginas
  const inicial = localStorage.getItem("idiomaPreferido") || "es";
  selector.value = inicial;
  cargarIdioma(inicial);
});
</script>
</body>
</html>